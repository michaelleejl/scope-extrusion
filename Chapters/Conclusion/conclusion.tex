\chapter{Conclusion}

This thesis makes progress on four fronts. 

\begin{enumerate}
\item It introduces a novel two-stage calculus, \calculusName{}, that allows for effect handlers at both stages: compile-time and run-time.\ \calculusName{} was designed to facilitate comparison of scope extrusion checks.

\item It formally describes and evaluates a range of scope extrusion solutions in \calculusName{}, including the existing MetaOCaml check \citep{kiselyov-14} and refined environment classifiers \citep{kiselyov-16}. This comparison was facilitated by \calculusName{}, validating its design.

\item It formally describes and evaluates a novel best-effort dynamic check, which finds a sweet spot between expressiveness and efficiency.

\item It has provided a basis for implementations of all three dynamic checks (lazy, eager, and best-effort) in MacoCaml. 
\end{enumerate}

\section{Limitations and Future Work}
\begin{minipage}[t]{0.25\textwidth}
  \textbf{\textsf{Let-Insertion}}
\end{minipage}%
\begin{minipage}[t]{0.75\textwidth}
  This thesis was primarily concerned with the \textit{undesirable} interaction of metaprogramming and effects, rather than their \textit{desirable} interaction: the previously described let-insertion \citep{yallop-2019}. 
  \vspace{2mm}

  I hypothesise that \calculusName{} is a good target in which to study let-insertion. Let-insertion has typically been studied in calculi where only pure programs can be generated \citep{isoda-24}. Let-insertion is more interesting when one can generate effectful programs. Since the order of operation becomes more important, it can be more challenging to describe an ``optimal'' insertion point.
  \vspace{4mm}
\end{minipage}\\

\noindent\begin{minipage}[t]{0.25\textwidth}
  \textbf{\textsf{Empirical Studies}}
\end{minipage}%
\begin{minipage}[t]{0.75\textwidth}
  I hypothesised that the dynamic checks differ in efficency in the common case. I would like to verify this with empirical studies.
  % \vspace{2mm}

  % \citet{kiselyov-14} additionally considers the \textit{usability} of scope extrusion solutions, in terms of the informativeness of error messages. I would like to perform user studies to evaluate usability.
  \vspace{4mm}
\end{minipage}\\

\noindent\begin{minipage}[t]{0.25\textwidth}
  \textbf{\textsf{Formalisation}}
\end{minipage}%
\begin{minipage}[t]{0.75\textwidth}
  The proofs in this thesis are pen-and-paper proofs. However, several are quite intricate (for example, the fundamental lemma of the \textsf{Scoped} logical relation). To provide greater confidence in present and future results, these proofs ought to be mechanised in a proof assistant.
\end{minipage}







