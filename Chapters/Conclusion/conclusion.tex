\chapter{Conclusion}

This thesis makes significant progress on four fronts. 

\begin{enumerate}
\item It introduces a novel two-stage calculus, \calculusName{}, that allows for effect handlers at both stages: compile-time and run-time.

\item It formally describes and evaluates a range of scope extrusion solutions in \calculusName{}, including the existing MacoCaml check \citep{kiselyov-14} and the refined environment classifiers approach \citep{kiselyov-16}. Such comparison was facilitated by \calculusName{}, validating its design.

\item It formally describes and evaluates a novel Best-Effort check, which occupies a goldilocks zone between expressiveness and efficiency.

\item It is supported by implementatopms of all three dynamic checks (lazy, eager, and best-effort) in MacoCaml. 
\end{enumerate}

\section{Limitations and Future Work}
\begin{minipage}[t]{0.25\textwidth}
  \textbf{\textsf{Let-Insertion}}
\end{minipage}%
\begin{minipage}[t]{0.75\textwidth}
  This thesis was primarily concern with the \textit{undesirable} interaction of metaprogramming and effects, rather than their \textit{desirable} interaction: the previously described let-insertion \citep{yallop-2019}. 
  \vspace{2mm}

  I conjecture that \calculusName{} is an ideal target in which to study let-insertion. Let-insertion has typically been studied in calculi where only pure programs can be generated \citep{isoda-24}. Let-insertion is more interesting when one can generate effectful programs. Since the order of operation becomes more important, it can be more challenging to describe an ``optimal'' insertion point.
  \vspace{4mm}
\end{minipage}\\

\noindent\begin{minipage}[t]{0.25\textwidth}
  \textbf{\textsf{Empirical Studies}}
\end{minipage}%
\begin{minipage}[t]{0.75\textwidth}
  I asserted that the dynamic checks differ in efficency, but in the common case, rather than worst case. I would like to verify this with empirical studies.
  \vspace{2mm}

  \citet{kiselyov-14} additionally considers the \textit{usability} of scope extrusion solutions, in terms of the informativeness of error messages. I did not consider this in my evaluation, but would like to perform user studies to more thoroughly evaluate usability.
  \vspace{4mm}
\end{minipage}\\

\noindent\begin{minipage}[t]{0.25\textwidth}
  \textbf{\textsf{Formalisation}}
\end{minipage}%
\begin{minipage}[t]{0.75\textwidth}
  The proofs in this thesis are pen-and-paper proofs. However, several are quite intricate (for example, the fundamental lemma of the \textsf{Scoped} logical relation). To ensure correctness, these proofs ought to be formalised in a theorem prover. Formalisation would additionally go further in operationalising \sourceLang{} as a testing bed for scope extrusion checks.
\end{minipage}







